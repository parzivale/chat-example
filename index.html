<!DOCTYPE html>
<html>
<head>
	<script defer src="https://widget-js.cometchat.io/v3/cometchatwidget.js"></script>
    <style>
        #cometchat {
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>

<body>
	<div id="cometchat"></div>
	<script>
    const urlParams = new URLSearchParams(window.location.search);
    const authToken = urlParams.get('auth');
    fetch("https://xpvx-7rob-ycvq.n7c.xano.io/api:MCjtN2rv/auth/me", {
        headers:{
            "Authorization": authToken
        }
    }).then(response => {
        response.json().then( data => {
        console.log(data);
        const chatAuth = data["chat_auth"];
        console.log(chatAuth);
		CometChatWidget.init({
			"appID": "248376389500c53a",
			"appRegion": "us",
			"authKey": "fd9e14214c8a005fb3fd82d1fe676bf4e2a9dc2e"
		}).then(response => {
			console.log("Initialization completed successfully");
			//You can now call login function.
			CometChatWidget.login({
				"authToken": chatAuth
			}).then(response => {
				CometChatWidget.launch({
					"widgetID": "cfda0de8-2b9b-42ec-a3ef-ebb846a0e8c7",
					"target": "#cometchat",
					"roundedCorners": "true",
					"height": "600px",
					"width": "800px",
					"defaultID": '174', //default UID (user) or GUID (group) to show,
					"defaultType": 'user' //user or group
				});
			}, error => {
				console.log("User login failed with error:", error);
				//Check the reason for error and take appropriate action.
			});
		}, error => {
			console.log("Initialization failed with error:", error);
			//Check the reason for error and take appropriate action.
		});
    });});
	</script>
</body>

</html>